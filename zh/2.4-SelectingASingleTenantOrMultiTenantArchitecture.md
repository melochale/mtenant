## 2.4 选择单租户或者多租户架构

本节介绍了一个架构师在决定一个单租户或者多租户设计时会考虑的一些准则，本节更仔细的重新思考这些主题，并在后面章节中引用Tailspin和Surveys应用。不同准则的相对重要性在不同的应用场景中变化很大。本章关注应用的架构、管理、和财务考虑。第三章“选择多租户数据架构”探索了更多的主题，他们是你在做一个合适的多租户数据架构是必须考虑的。

### 2.4.1 架构考虑

你应用的架构要求会影响你做单租户还是多租户架构的决定。

本节的重点是使用Windows Azure的云服务打造多租户应用：Web角色和辅助角色。然后在本章中安排的架构考虑，以及接下来的章节讨论的Tailspin实现Surveys应用时遇到的许多设计决策，同样的与你的多租户应用托管决策相关。例如，如果你决定使用Windows Azure Web网站服务打造多租户应用，或者使用Windows Azure虚拟机来部署它，你会面临和Tailspin许多相同的开发挑战，是它在使用Window Azure云服务开发在打造Surveys应用遇到的。

详细讨论Windows Azure虚拟机提供的“基础设施即服务（IaaS: Infrastructure as a Service）”方案，你应该阅读《云端应用迁移指南》中的第二章“云技术使用准备”，和第三章”迁移至Windows Azure云服务“，它讨论了使用Window Azure Web网站服务来在云端托管你的应用。

**应用稳定性**

多租户的应用比单租户应用更容易出现实例故障。如果一个单租户应用的实例出现故障，只有唯一的实例用户受到影响。如果多租户实例故障，所有用户都会波及。然而Windows Azure可以通过部署多重同样的Window Azure角色实例来减低风险，这些角色实例组成你的应用（这是真正的多租户多实例模型）。

Windows Azure的负载均衡在多个实例间执行请求，当你部署多个实例时，你必须设计你的应用来正常的运行。例如，如果你的应用使用会话状态，你必须保证每个Web角色实例的任何用户可以访问这些状态。除此之外，当Windows Azure可以选择任何一个辅助角色执行一些特殊的任务时，这些辅助角色必须正确的执行任务。Window Azure监控你的角色实例摈弃出现失效时自动重启。

*对于Windows Azure SLA在你应用中使用时，你必须至少有每种角色实例类型的两个实例在运行。更多的信息查看“服务等级协议（SLA: Service Level Agreements）”*

Windows Azure可以节流资源的访问，使他们暂时的不可用。特别是当资源的高度争用时发生。你的Window Azure应用应该在其被节流时检测到，并且采取适当的措施如一段延时后重试操作。

![Bharath](images/persona-Bharath-R-h55.png)
*瞬时故障处理应用程序块（The Transient Fault Handling Application Block）,作为企业库5.0集成包的一个单独安装部分，能以标准和可配置的方式处理因节流引起的瞬时故障。*

**应用可伸缩**

运行在Windows Azure上的应用伸缩性很大程度上依赖于你能部署的多个Web角色和辅助角色实例，当能通过这些角色实例访问同样的数据时。Windows Azure上的单租户和多租户应用都使用这个特性来水平扩展应用。Window Azure同样也提供不同实例的性能让你可以垂直扩展或缩小单独的实例。

Figure 3 shows how you can scale out the application by running a variable number of instances. In Windows Azure cloud services, these would be multiple instances of your web and worker roles.